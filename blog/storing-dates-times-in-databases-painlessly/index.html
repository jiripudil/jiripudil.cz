<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><title>Storing dates and times in databases: the painless way – Blog – Jiří Pudil</title><style>.body[data-astro-cid-relfimn4]{padding:1.5rem 0}h1[data-astro-cid-relfimn4]{text-wrap:balance}.metadata[data-astro-cid-relfimn4]{display:flex;align-items:start;justify-content:space-between;gap:1rem;margin-bottom:3rem;ul{margin:0;padding:0;list-style:none;display:flex;flex-wrap:wrap;gap:0 .5rem;font-size:.9rem;a{color:var(--body-diminished-color);&:hover{color:var(--body-text-color)}}}time{flex-shrink:0;color:var(--body-diminished-color)}}.perex[data-astro-cid-relfimn4]{font-size:1.15rem}.content[data-astro-cid-relfimn4]{h2{margin-top:3rem}h3{margin-top:2.25rem}p{text-wrap:pretty;hyphens:auto}:is(ul,ol) li{line-height:1.6;margin-bottom:.5rem}blockquote{position:relative;&:before{content:"“";position:absolute;left:-2.25rem;top:0;color:var(--body-accent-color);font-size:4rem}}img{max-width:100%;height:auto}iframe{max-width:100%;aspect-ratio:16 / 9}code{hyphens:none}.astro-code{margin:.5rem 0;padding:.5rem;font-size:.9rem;tab-size:4}}.comments[data-astro-cid-relfimn4]{margin-top:3rem}@media (max-width: 40rem){.metadata[data-astro-cid-relfimn4]{flex-direction:column;align-items:start;justify-content:start}}
</style><link rel="stylesheet" href="/_astro/about.BrkH-_VM.css"><meta name="generator" content="Astro v5.7.8"><meta name="theme-color" content="#fff" media="(prefers-color-scheme: light)"><meta name="theme-color" content="#242428" media="(prefers-color-scheme: dark)"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="Blog – Jiří Pudil" href="/blog/rss.xml"><link rel="alternate" type="application/rss+xml" title="Notes – Jiří Pudil" href="/notes/rss.xml"><link rel="webmention" href="https://webmention.io/jiripudil.cz/webmention"><meta name="google-site-verification" content="7fHBkeNq7LXO24W8IjCc37NT9MX-6RJxD3Co5F-bRQw"><meta property="og:site_name" content="Jiří Pudil"><meta property="og:title" content="Storing dates and times in databases: the painless way – Blog"><meta property="og:type" content="article"><meta property="article:published_time" content="2022-03-03T07:00:00.000Z"><meta property="article:tag" content="database"><meta property="article:tag" content="datetime"><meta property="article:tag" content="sql"><meta property="article:tag" content="time"><link rel="manifest" href="/manifest.webmanifest"><meta name="mobile-web-app-capable" content="yes"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#fff"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000"><meta name="application-name" content="Jiří Pudil"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon-precomposed.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#fff"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="apple-mobile-web-app-title" content="Jiří Pudil"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"><link rel="icon" type="image/png" sizes="48x48" href="/favicon-48x48.png"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="msapplication-TileColor" content="#fff"><meta name="msapplication-TileImage" content="/mstile-144x144.png"><meta name="msapplication-config" content="/browserconfig.xml"><link rel="yandex-tableau-widget" href="/yandex-browser-manifest.json"></head> <body> <div class="header" data-astro-cid-3ef6ksr2> <div class="container" data-astro-cid-d6puh33w>  <nav class="menu" data-astro-cid-3ef6ksr2> <ul data-astro-cid-3ef6ksr2> <li class="name" data-astro-cid-3ef6ksr2> <a href="/" title="Home" data-astro-cid-3ef6ksr2>
Jiří Pudil
</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/about" data-astro-cid-3ef6ksr2>
About
</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/projects" data-astro-cid-3ef6ksr2>
Projects
</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/blog" class="active" data-astro-cid-3ef6ksr2>
Blog
</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/notes" data-astro-cid-3ef6ksr2>
Notes
</a> </li> <li data-astro-cid-3ef6ksr2> <a href="/talks" data-astro-cid-3ef6ksr2>
Talks
</a> </li> </ul> </nav>  </div>  </div>    <div class="container" data-astro-cid-d6puh33w>  <div class="body" data-astro-cid-relfimn4> <h1 data-astro-cid-relfimn4>Storing dates and times in databases: the painless way</h1> <div class="metadata" data-astro-cid-relfimn4> <ul data-astro-cid-relfimn4> <li data-astro-cid-relfimn4><a href="/blog/tag/database" data-astro-cid-relfimn4>#database</a></li><li data-astro-cid-relfimn4><a href="/blog/tag/datetime" data-astro-cid-relfimn4>#datetime</a></li><li data-astro-cid-relfimn4><a href="/blog/tag/sql" data-astro-cid-relfimn4>#sql</a></li><li data-astro-cid-relfimn4><a href="/blog/tag/time" data-astro-cid-relfimn4>#time</a></li> </ul> <time datetime="2022-03-03T07:00:00.000Z" data-astro-cid-relfimn4> Mar 3, 2022 </time> </div> <p class="perex" data-astro-cid-relfimn4>I've already talked about working with date and time values on both sides of the web stack. However, in web development, we not only manipulate temporal values, we often need to store them somewhere and retrieve them later. This post discusses the best methods of persisting dates and times in databases.</p> <div class="content" data-astro-cid-relfimn4> <blockquote>
<p>This is the third installment in a series of posts about handling date and time in web applications:</p>
<ol>
<li><a href="/blog/beyond-datetime-domain-driven-approach">Beyond DateTime: a domain-driven approach to date and time</a></li>
<li><a href="/blog/beyond-date">Beyond Date: bulletproof date and time API in JavaScript</a></li>
<li><strong>Storing dates and times in databases: the painless way</strong></li>
<li><a href="/blog/your-application-needs-clock">Your application needs a clock</a></li>
</ol>
</blockquote>
<p>In the previous two posts, I’ve covered working with date and time both <a href="/blog/beyond-datetime-domain-driven-approach">in PHP</a> and <a href="/blog/beyond-date">in JavaScript</a>, and sending temporal values back and forth between the client and the server. One of the remaining topics is about storing date and time in databases.</p>
<p>If you haven’t read the previous posts — especially the first one —, please do so now because it lays quite a lot of necessary groundwork. I’m going to refer to most of the concepts introduced there throughout this post. In fact, I think it will be best to list them one by one and discuss the most suitable SQL data type (or types) to store each of them. After all, we’ve already established the concepts and we know what kind of temporal data we need to represent and store.</p>
<h2 id="sql-data-types">SQL data types</h2>
<p>Before we start, let’s skim through the relevant data types we have at our disposal. I’m going to talk specifically about PostgreSQL for several reasons: it tends to lean a lot towards compatibility with the SQL standard; I have the most experience with it; and I simply love it.</p>
<p>PostgreSQL (in line with the standard) defines three date-time data types: <code>DATE</code> for a date value without any time of day, <code>TIME</code> for a time value without specific date, and <code>TIMESTAMP</code> as a combination of the two. The latter two types come in two flavours: <code>WITH</code> and <code>WITHOUT TIME ZONE</code>. Finally, there’s also <code>INTERVAL</code> for a temporal interval.</p>
<p>Let’s see how we can use these types to represent various temporal concepts introduced in the <a href="/blog/beyond-datetime-domain-driven-approach">initial post</a>.</p>
<h2 id="localdate-and-localtime">LocalDate and LocalTime</h2>
<p>We’ll start with the low-hanging fruits: <code>LocalDate</code> and <code>LocalTime</code> values are very simple to store because they map exactly to a <code>DATE</code> and a <code>TIME [WITHOUT TIME ZONE]</code> data types, respectively:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> datetimes</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#50A14F;--shiki-dark:#98C379">"date"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> date</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, </span><span style="color:#50A14F;--shiki-dark:#98C379">"time"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> time</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>The mapping from and to PHP is quite straightforward:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> datetimes (</span><span style="color:#50A14F;--shiki-dark:#98C379">"date"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, </span><span style="color:#50A14F;--shiki-dark:#98C379">"time"</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?, ?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$localDate</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, (</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$localTime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span></code></pre>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$dates</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> fn</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) => </span><span style="color:#C18401;--shiki-dark:#E5C07B">LocalDate</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">of</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'date'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]),</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#50A14F;--shiki-dark:#98C379"> "date"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> datetimes</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$times</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> fn</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) => </span><span style="color:#C18401;--shiki-dark:#E5C07B">LocalTime</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">of</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'time'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]),</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#50A14F;--shiki-dark:#98C379"> "time"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> datetimes</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<h2 id="localdatetime">LocalDateTime</h2>
<p>Similarly, a <code>LocalDateTime</code> can be stored in a <code>TIMESTAMP WITHOUT TIME ZONE</code>:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> datetimes</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">datetime</span><span style="color:#A626A4;--shiki-dark:#C678DD"> timestamp without time zone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>There is one caveat, though: PostgreSQL’s default date-time format, amusingly called ‘ISO,’ differs from the actual ISO 8601 format. While the specification puts a <code>T</code> between the date and time parts, the ISO format in PostgreSQL uses a single space in its place.</p>
<p>The conforming format (with a <code>T</code>) is accepted on the input, so it’s enough to just convert the <code>LocalDateTime</code> to string when inserting into the database:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> datetimes (</span><span style="color:#A626A4;--shiki-dark:#C678DD">datetime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$localDateTime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span></code></pre>
<p>The reading part is a bit trickier, though, because the database output always uses space. You’ll need a custom parser for that:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">new</span><span style="color:#C18401;--shiki-dark:#E5C07B"> PatternParserBuilder</span><span style="color:#383A42;--shiki-dark:#ABB2BF">())</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">append</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#C18401;--shiki-dark:#E5C07B">IsoParsers</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">localDate</span><span style="color:#383A42;--shiki-dark:#ABB2BF">())</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">appendLiteral</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">' '</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">append</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#C18401;--shiki-dark:#E5C07B">IsoParsers</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">localTime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">())</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">toParser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$localDateTimes</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> function</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">use</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">        return</span><span style="color:#C18401;--shiki-dark:#E5C07B"> LocalDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">parse</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'datetime'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">], </span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#A626A4;--shiki-dark:#C678DD"> datetime</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> datetimes</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<h2 id="instant">Instant</h2>
<p>Since instant is basically a (large) number of seconds since the Unix epoch, it’s easy to grab the numeric value and store it in a <code>BIGINT</code> column:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> instants</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">bigint</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>Using <code>BIGINT</code> is effortless for the computer because it doesn’t require any conversion. You just grab <code>$instant->getEpochSecond()</code> when saving the data:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants (instant) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([</span><span style="color:#E45649;--shiki-dark:#E06C75">$instant</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">getEpochSecond</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()]);</span></span></code></pre>
<p>And you recreate <code>Instant::of($timestamp)</code> when reading it from the database:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$instants</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> fn</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) => </span><span style="color:#C18401;--shiki-dark:#E5C07B">Instant</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">of</span><span style="color:#383A42;--shiki-dark:#ABB2BF">((</span><span style="color:#A626A4;--shiki-dark:#C678DD">int</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'instant'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]),</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>But it’s not as comfortable for humans if you need to inspect the data manually: it puts some cognitive load on humans to parse huge numbers or compare them against each other, and you cannot really make anything of a huge numeric timestamp without converting it to a date-time value first. That’s tedious if you need to reach into the database during debugging:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants;</span></span></code></pre>











<table><thead><tr><th>instant</th></tr></thead><tbody><tr><td>1646290800</td></tr></tbody></table>
<p>You have to convert these values in the query to get anything useful:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> to_timestamp(instant) </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants;</span></span></code></pre>











<table><thead><tr><th>to_timestamp</th></tr></thead><tbody><tr><td>2022-03-03 07:00:00 +00:00</td></tr></tbody></table>
<p>Another viable point of view, and one that I slightly prefer, is that an instant represents a timestamp, and should therefore be stored in a <code>TIMESTAMP [WITHOUT TIME ZONE]</code> data type:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> instants</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">timestamp without time zone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>The conversion from PHP to database is easy, because <code>Instant</code> exposes a handy implementation of <code>__toString()</code> that formats the instant as a date-time in UTC:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants (instant) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$instant</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span></code></pre>
<p>When converting from database to PHP, you’ll have to reuse the custom parser introduced in the <code>LocalDateTime</code> section, and convert the parsed value to an instant:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$instants</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> function</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">use</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">        $localDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#C18401;--shiki-dark:#E5C07B"> LocalDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">parse</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'instant'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">], </span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">        return</span><span style="color:#E45649;--shiki-dark:#E06C75"> $localDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">atTimeZone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#C18401;--shiki-dark:#E5C07B">TimeZone</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">utc</span><span style="color:#383A42;--shiki-dark:#ABB2BF">())</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">getInstant</span><span style="color:#383A42;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>In exchange, you get a formatted date and time, which is much easier to process for a human brain:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instant </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants;</span></span></code></pre>











<table><thead><tr><th>instant</th></tr></thead><tbody><tr><td>2022-03-03 07:00:00</td></tr></tbody></table>
<p>On top of that, <code>TIMESTAMP</code> is a better choice if you need timestamps with a higher resolution:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> instants (instant) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#50A14F;--shiki-dark:#98C379">'2022-03-03 07:00:00.123456'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<h2 id="zoneddatetime">ZonedDateTime</h2>
<p>The trickiest of them all is the <code>ZonedDateTime</code>. It might seem intuitive that the <code>TIMESTAMP WITH TIME ZONE</code> variant would be perfect for this, but it’s quite the contrary.</p>
<p>The sneaky quirk of the type is that it is only <em>aware</em> of the time zone on the <em>input</em>. If you give it a value with a time zone, it normalizes it into UTC and stores that normalized value. Upon retrieval, it converts the value to the time zone as configured for the server instance:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> zoned</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#50A14F;--shiki-dark:#98C379">"datetime"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> timestamp with time zone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> zoned </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#50A14F;--shiki-dark:#98C379">'2022-03-03 08:00:00+01'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SET</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> timezone </span><span style="color:#383A42;--shiki-dark:#C678DD">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> 'Europe/Kiyv'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#50A14F;--shiki-dark:#98C379"> "datetime"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> zoned;</span></span></code></pre>











<table><thead><tr><th>datetime</th></tr></thead><tbody><tr><td>2022-03-03 09:00:00+02</td></tr></tbody></table>
<p>You can enforce a different time zone explicitly:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#50A14F;--shiki-dark:#98C379"> "datetime"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> AT</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TIME</span><span style="color:#A626A4;--shiki-dark:#C678DD"> ZONE</span><span style="color:#50A14F;--shiki-dark:#98C379"> 'Europe/Prague'</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> zoned;</span></span></code></pre>











<table><thead><tr><th>datetime</th></tr></thead><tbody><tr><td>2022-03-03 08:00:00</td></tr></tbody></table>
<p>But all the database ensures is that the resulting value always points to the same <em>instant</em>. It does <em>not</em>, however, preserve the time zone information – that is effectively lost when you save the value.</p>
<p>The trick is to store the <code>LocalDateTime</code> value in a <code>TIMESTAMP WITHOUT TIME ZONE</code> instead, and save the time zone identifier along with it. You can use a separate column, or you can make use of PostgreSQL’s composite types to store them in a single column:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> zoned</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#50A14F;--shiki-dark:#98C379">"datetime"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> timestamp without time zone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, </span><span style="color:#50A14F;--shiki-dark:#98C379">"timezone"</span><span style="color:#A626A4;--shiki-dark:#C678DD"> text</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> zoned (</span><span style="color:#A626A4;--shiki-dark:#C678DD">datetime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, timezone) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?, ?)</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$zonedDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">getDateTime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(), </span><span style="color:#E45649;--shiki-dark:#E06C75">$zonedDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">getTimeZone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">getId</span><span style="color:#383A42;--shiki-dark:#ABB2BF">()]);</span></span></code></pre>
<p>Either way, you can safely reconstruct an instance of a <code>ZonedDateTime</code> in the original time zone from these. Again, you’ll have to make use of the custom parser from above:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$zonedDateTimes</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> function</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">use</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">        $localDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#C18401;--shiki-dark:#E5C07B"> LocalDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">parse</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'datetime'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">], </span><span style="color:#E45649;--shiki-dark:#E06C75">$parser</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">        $timeZone</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#C18401;--shiki-dark:#E5C07B"> TimeZone</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">of</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'timezone'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">        return</span><span style="color:#C18401;--shiki-dark:#E5C07B"> ZonedDateTime</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">of</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$localDateTime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, </span><span style="color:#E45649;--shiki-dark:#E06C75">$timeZone</span><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#A626A4;--shiki-dark:#C678DD"> datetime</span><span style="color:#383A42;--shiki-dark:#ABB2BF">, timezone </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> zoned</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<h2 id="duration-and-period">Duration and Period</h2>
<p>Sometimes you might have to store time intervals, such as race results or the length of a validity period. While <code>Duration</code>s (a deterministic time-based interval) and <code>Period</code>s (a calendar-based interval) are two entirely different things that cannot be mixed together, PostgreSQL defines the <code>INTERVAL</code> type to store either of them:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> durations</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (duration interval);</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">CREATE</span><span style="color:#A626A4;--shiki-dark:#C678DD"> TABLE</span><span style="color:#4078F2;--shiki-dark:#61AFEF"> periods</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (</span><span style="color:#A626A4;--shiki-dark:#C678DD">period</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> interval);</span></span></code></pre>
<p>The database recognizes the standard ISO format on the input, so the conversion from PHP is again just a matter of casting the value to string:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> durations (duration) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$duration</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> periods (</span><span style="color:#A626A4;--shiki-dark:#C678DD">period</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#A626A4;--shiki-dark:#C678DD">VALUES</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> (?);</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#C678DD">    -></span><span style="color:#4078F2;--shiki-dark:#61AFEF">execute</span><span style="color:#383A42;--shiki-dark:#ABB2BF">([(</span><span style="color:#A626A4;--shiki-dark:#C678DD">string</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) </span><span style="color:#E45649;--shiki-dark:#E06C75">$period</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]);</span></span></code></pre>
<p>Unfortunately, PostgreSQL defaults to its own format of interval output which looks like <code>02:30</code> or <code>1 year 3 mons</code>. Unless you want to implement a parser for this format in PHP, I recommend you configure the database to use the more universal ISO 8601:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="sql"><code><span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">SET</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> intervalstyle </span><span style="color:#383A42;--shiki-dark:#C678DD">=</span><span style="color:#50A14F;--shiki-dark:#98C379"> 'iso_8601'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<p>This time, it’s actually a standard-compliant format, so you can easily read and convert the values to PHP:</p>
<pre class="astro-code astro-code-themes OneLight OneDark" style="background-color:#FAFAFA;--shiki-dark-bg:#282C34;color:#383A42;--shiki-dark:#ABB2BF; overflow-x: auto;" tabindex="0" data-language="php"><code><span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$durations</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> fn</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) => </span><span style="color:#C18401;--shiki-dark:#E5C07B">Duration</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">parse</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'duration'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]),</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> duration </span><span style="color:#A626A4;--shiki-dark:#C678DD">FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> durations</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">$periods</span><span style="color:#383A42;--shiki-dark:#C678DD"> =</span><span style="color:#0184BC;--shiki-dark:#56B6C2"> array_map</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#A626A4;--shiki-dark:#C678DD">    static</span><span style="color:#A626A4;--shiki-dark:#C678DD"> fn</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#A626A4;--shiki-dark:#C678DD">array</span><span style="color:#E45649;--shiki-dark:#E06C75"> $row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">) => </span><span style="color:#C18401;--shiki-dark:#E5C07B">Period</span><span style="color:#383A42;--shiki-dark:#C678DD">::</span><span style="color:#4078F2;--shiki-dark:#61AFEF">parse</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#E45649;--shiki-dark:#E06C75">$row</span><span style="color:#383A42;--shiki-dark:#ABB2BF">[</span><span style="color:#50A14F;--shiki-dark:#98C379">'period'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">]),</span></span>
<span class="line"><span style="color:#E45649;--shiki-dark:#E06C75">    $pdo</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">prepare</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#A626A4;--shiki-dark:#C678DD">SELECT</span><span style="color:#A626A4;--shiki-dark:#C678DD"> period</span><span style="color:#A626A4;--shiki-dark:#C678DD"> FROM</span><span style="color:#383A42;--shiki-dark:#ABB2BF"> periods</span><span style="color:#50A14F;--shiki-dark:#98C379">'</span><span style="color:#383A42;--shiki-dark:#ABB2BF">)</span><span style="color:#383A42;--shiki-dark:#C678DD">-></span><span style="color:#4078F2;--shiki-dark:#61AFEF">fetchAll</span><span style="color:#383A42;--shiki-dark:#ABB2BF">(),</span></span>
<span class="line"><span style="color:#383A42;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<p>While the database provides a single data type for both <code>Duration</code>s and <code>Period</code>s, make sure not to mix the two concepts. The database is capable of storing an interval of 2 months and 2 hours, but you won’t be able to parse such value into either of the PHP classes.</p>
<h2 id="closing-thoughts">Closing thoughts</h2>
<p>I hope this post has been exhaustive but not exhausting. I believe the mappings I’ve shown here map temporal concepts from PHP onto the most appropriate database data types, hiding as many footguns from you as possible, while still letting you comfortably access and even manipulate the values through SQL directly.</p>
<p>In many cases, conversions from the database to PHP and vice versa require some additional logic, or even custom parsers. Luckily, many database abstractions in PHP allow you to define custom type mapping, so that this kind of code only lies in one place, letting your application deal with pure, immutable representations of various aspects of time.</p>
<p>While this post has only focused on PostgreSQL in particular, lots of other SQL databases expose similar data types and capabilities. Take time to get to know your database, and pay special attention to little nuances; for instance, MySQL defines distinct <code>DATETIME</code> and <code>TIMESTAMP</code> types, but they are semantically equal to PostgreSQL’s <code>TIMESTAMP WITHOUT TIME ZONE</code> and <code>TIMESTAMP WITH TIME ZONE</code>, respectively, including the quirks with losing the time zone.</p>
<p>If you’ve read the whole series carefully (just a reminder to check out the previous <a href="/blog/beyond-datetime-domain-driven-approach">two</a> <a href="/blog/beyond-date">posts</a>), I think you should by now also have a sufficient mental framework to be able to map temporal concepts to other kinds of databases such as document databases. Generally, always start from the conceptual level and your specific needs and use cases.</p>
<p>If you have any remarks or questions, feel free to join the discussion. Either way, I’m looking forward to see you in the next, last installment to this series of posts on time. This time, we’re going to talk about telling time. Stay tuned!</p> </div> <div class="comments" data-astro-cid-relfimn4> <div id="giscus-container"></div> <script type="module">const t=document.createElement("script");t.src="https://giscus.app/client.js";t.crossOrigin="anonymous";t.async=!0;t.setAttribute("data-repo","jiripudil/jiripudil.cz");t.setAttribute("data-repo-id","MDEwOlJlcG9zaXRvcnkyNTI5NzY3Nw==");t.setAttribute("data-category","Blog discussions");t.setAttribute("data-category-id","DIC_kwDOAYIDDc4CAfUM");t.setAttribute("data-mapping","og:title");t.setAttribute("data-reactions-enabled","1");t.setAttribute("data-emit-metadata","0");t.setAttribute("data-theme","preferred_color_scheme");t.setAttribute("data-lang","en");t.setAttribute("data-loading","lazy");const e=document.getElementById("giscus-container");e.appendChild(t);</script> </div> </div>  </div>   <div class="footer" data-astro-cid-sz7xmlte> <div class="container" data-astro-cid-d6puh33w> 
Content licensed under
<a href="https://creativecommons.org/licenses/by/4.0/" title="Creative Commons Attribution 4.0 International" aria-label="Creative Commons Attribution 4.0 International" data-astro-cid-sz7xmlte> <svg width="0.97em" height="1em" data-astro-cid-sz7xmlte="true" data-icon="fa6-brands:creative-commons">   <symbol id="ai:fa6-brands:creative-commons" viewBox="0 0 496 512"><path fill="currentColor" d="m245.83 214.87l-33.22 17.28c-9.43-19.58-25.24-19.93-27.46-19.93c-22.13 0-33.22 14.61-33.22 43.84c0 23.57 9.21 43.84 33.22 43.84c14.47 0 24.65-7.09 30.57-21.26l30.55 15.5c-6.17 11.51-25.69 38.98-65.1 38.98c-22.6 0-73.96-10.32-73.96-77.05c0-58.69 43-77.06 72.63-77.06c30.72-.01 52.7 11.95 65.99 35.86m143.05 0l-32.78 17.28c-9.5-19.77-25.72-19.93-27.9-19.93c-22.14 0-33.22 14.61-33.22 43.84c0 23.55 9.23 43.84 33.22 43.84c14.45 0 24.65-7.09 30.54-21.26l31 15.5c-2.1 3.75-21.39 38.98-65.09 38.98c-22.69 0-73.96-9.87-73.96-77.05c0-58.67 42.97-77.06 72.63-77.06c30.71-.01 52.58 11.95 65.56 35.86M247.56 8.05C104.74 8.05 0 123.11 0 256.05c0 138.49 113.6 248 247.56 248c129.93 0 248.44-100.87 248.44-248c0-137.87-106.62-248-248.44-248m.87 450.81c-112.54 0-203.7-93.04-203.7-202.81c0-105.42 85.43-203.27 203.72-203.27c112.53 0 202.82 89.46 202.82 203.26c-.01 121.69-99.68 202.82-202.84 202.82"/></symbol><use href="#ai:fa6-brands:creative-commons"></use>  </svg> <svg width="0.97em" height="1em" data-astro-cid-sz7xmlte="true" data-icon="fa6-brands:creative-commons-by">   <symbol id="ai:fa6-brands:creative-commons-by" viewBox="0 0 496 512"><path fill="currentColor" d="M314.9 194.4v101.4h-28.3v120.5h-77.1V295.9h-28.3V194.4c0-4.4 1.6-8.2 4.6-11.3c3.1-3.1 6.9-4.7 11.3-4.7H299c4.1 0 7.8 1.6 11.1 4.7c3.1 3.2 4.8 6.9 4.8 11.3m-101.5-63.7c0-23.3 11.5-35 34.5-35s34.5 11.7 34.5 35q0 34.5-34.5 34.5c-34.5 0-34.5-11.5-34.5-34.5M247.6 8C389.4 8 496 118.1 496 256c0 147.1-118.5 248-248.4 248C113.6 504 0 394.5 0 256C0 123.1 104.7 8 247.6 8m.8 44.7C130.2 52.7 44.7 150.6 44.7 256c0 109.8 91.2 202.8 203.7 202.8c103.2 0 202.8-81.1 202.8-202.8c.1-113.8-90.2-203.3-202.8-203.3"/></symbol><use href="#ai:fa6-brands:creative-commons-by"></use>  </svg> </a>  </div>  </div>  </body></html> 